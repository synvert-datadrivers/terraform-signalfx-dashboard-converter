on:
  pull_request:
    branches:
      - main
    paths:
      - 'examples/default-dashboard-export/**'
      - '.github/workflows/pull_request.yml'

permissions:
  contents: write # semantic relasese test write access even on dry-run
  pull-requests: write

jobs:
  terraform-validate:
    name: Validate Example
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: run terraform
        uses: datadrivers/terragrunt-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          terraform-version: "latest"
          skip-caches: "false"
          enable-debug: "true"
          enable-terraform-change-pr-commenter: "true"
          commands: |
            cd examples/default-dashboard-export
            terraform init
            terraform plan -out terraform.tfplan


      - name: debug
        run: |
          git ls-remote --heads origin

      - name: Test Semantic Release
        uses: cycjimmy/semantic-release-action@v4.0.0
        with:
          extra_plugins: |
            @semantic-release/changelog
          dry_run: true
          ci: false
          branches: |
            [
              "${{ github.head_ref }}",
              "${{ github.ref }}",
            ]
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEBUG: "semantic-release:*"
